# wan-monitor-openwrt

> ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° Ð´Ð»Ñ OpenWrt Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¾Ð¹ Ð¿Ñ€Ð¸ Ð¿Ð¾Ñ‚ÐµÑ€Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ð°

## ðŸ“‹ ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ

Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ OpenWrt, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ð° Ð½Ð° WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐµ Ð¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ ÐµÐ³Ð¾ Ð¿Ñ€Ð¸ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸ÐµÐ¼. Ð˜Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ Ð½ÐµÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚-ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹, ÐºÐ¾Ð³Ð´Ð° Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ²ÑÐ·Ð¸.

### âœ¨ ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸

- ðŸ” **ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°** â€” Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
- ðŸŒ **ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð´Ð²Ð° DNS ÑÐµÑ€Ð²ÐµÑ€Ð°** (Google Ð¸ Cloudflare)
- ðŸ”„ **ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°** Ð¿Ñ€Ð¸ Ð¿Ð¾Ñ‚ÐµÑ€Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ð°
- ðŸ“Š **ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ** Ð²ÑÐµÑ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ð¼ÐµÑ‚ÐºÐ°Ð¼Ð¸
- â° **ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°** Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ Ñ‡ÐµÑ€ÐµÐ· cron
- ðŸŽ¯ **Ð£Ð¼Ð½Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ° Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°** â€” Ð²Ñ‹Ð¶Ð¸Ð´Ð°ÐµÑ‚ 30 ÑÐµÐºÑƒÐ½Ð´ Ð´Ð»Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°

1. **Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð½Ð° Ñ€Ð¾ÑƒÑ‚ÐµÑ€:**
```sh
wget -O /root/wan_monitor.sh https://raw.githubusercontent.com/lQwestl/wan-monitor-openwrt/main/wan_monitor.sh
chmod +x /root/wan_monitor.sh
```

Ð˜Ð»Ð¸ ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ:
```sh
nano /root/wan_monitor.sh
# Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°
chmod +x /root/wan_monitor.sh
```

2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ:**
```sh
/root/wan_monitor.sh
```

### ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°

**Ð”Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÐºÐ°Ð¶Ð´Ñ‹Ðµ 10 Ð¼Ð¸Ð½ÑƒÑ‚:**

```sh
# ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ crontab
crontab -e

# Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ñ€Ð¾ÐºÑƒ
*/10 * * * * /root/wan_monitor.sh

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ cron
/etc/init.d/cron restart
```

**Ð”Ñ€ÑƒÐ³Ð¸Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ñ:**

```sh
# ÐšÐ°Ð¶Ð´Ñ‹Ðµ 5 Ð¼Ð¸Ð½ÑƒÑ‚
*/5 * * * * /root/wan_monitor.sh

# ÐšÐ°Ð¶Ð´Ñ‹Ðµ 15 Ð¼Ð¸Ð½ÑƒÑ‚
*/15 * * * * /root/wan_monitor.sh

# ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ñ‡Ð°Ñ
0 * * * * /root/wan_monitor.sh
```

## ðŸ”§ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°

Ð’ Ð½Ð°Ñ‡Ð°Ð»Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:

```sh
PING_HOST="8.8.8.8"          # ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ…Ð¾ÑÑ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ (Google DNS)
PING_HOST_2="1.1.1.1"        # Ð ÐµÐ·ÐµÑ€Ð²Ð½Ñ‹Ð¹ Ñ…Ð¾ÑÑ‚ (Cloudflare DNS)
PING_COUNT=3                  # ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ð¸Ð½Ð³-Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
PING_TIMEOUT=5                # Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿Ð¸Ð½Ð³Ð° (ÑÐµÐºÑƒÐ½Ð´Ñ‹)
LOG_FILE="/var/log/wan_monitor.log"  # ÐŸÑƒÑ‚ÑŒ Ðº Ñ„Ð°Ð¹Ð»Ñƒ Ð»Ð¾Ð³Ð¾Ð²
```

### Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸

**Ð”Ð»Ñ ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ñ… ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹:**
- Ð˜Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸: 15 Ð¼Ð¸Ð½ÑƒÑ‚
- PING_COUNT: 3
- PING_TIMEOUT: 5

**Ð”Ð»Ñ Ð½ÐµÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ñ… ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹:**
- Ð˜Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸: 5 Ð¼Ð¸Ð½ÑƒÑ‚
- PING_COUNT: 5
- PING_TIMEOUT: 3

## ðŸ“Š Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð»Ð¾Ð³Ð°Ð¼Ð¸

### ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð²

```sh
# ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²ÐµÑÑŒ Ð»Ð¾Ð³
cat /var/log/wan_monitor.log

# ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 50 ÑÑ‚Ñ€Ð¾Ðº
tail -n 50 /var/log/wan_monitor.log

# Ð¡Ð»ÐµÐ´Ð¸Ñ‚ÑŒ Ð·Ð° Ð»Ð¾Ð³Ð¾Ð¼ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
tail -f /var/log/wan_monitor.log

# ÐÐ°Ð¹Ñ‚Ð¸ Ð²ÑÐµ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°
grep "ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°" /var/log/wan_monitor.log
```

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð²Ñ‹Ð²Ð¾Ð´Ð° Ð»Ð¾Ð³Ð°

```
[2025-10-02 17:32:41] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2025-10-02 17:32:41] Ð—Ð°Ð¿ÑƒÑÐº Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°
[2025-10-02 17:32:41] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[2025-10-02 17:32:41] âœ“ ÐÐ°Ð¹Ð´ÐµÐ½ WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ: wan
[2025-10-02 17:32:41] Ð›Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ: wan
[2025-10-02 17:32:41] Ð¤Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾: eth1
[2025-10-02 17:32:41] Ð¥Ð¾ÑÑ‚Ñ‹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸: 8.8.8.8, 1.1.1.1
[2025-10-02 17:32:41] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2025-10-02 17:32:41] ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ñƒ...
[2025-10-02 17:32:41] âœ“ Ð˜Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡ÐµÑ€ÐµÐ· 8.8.8.8)
[2025-10-02 17:32:41] ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½: Ð²ÑÐµ Ð² Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ
[2025-10-02 17:32:41] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð»Ð¾Ð³Ð¾Ð²

```sh
# ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð»Ð¾Ð³ Ñ„Ð°Ð¹Ð»
> /var/log/wan_monitor.log

# Ð˜Ð»Ð¸ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ
rm /var/log/wan_monitor.log
```

## ðŸ” ÐšÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚

1. **ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°:**
   - Ð˜Ñ‰ÐµÑ‚ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑ‹ Ñ Ð¸Ð¼ÐµÐ½ÐµÐ¼ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¼ "wan"
   - ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°
   - Ð’ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ñ€ÐµÐ·ÐµÑ€Ð²Ð° Ð¸Ñ‰ÐµÑ‚ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ñ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¾Ð¼ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ

2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸:**
   - ÐŸÐ¸Ð½Ð³ÑƒÐµÑ‚ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ…Ð¾ÑÑ‚ (Google DNS 8.8.8.8)
   - ÐŸÑ€Ð¸ Ð½ÐµÑƒÐ´Ð°Ñ‡Ðµ Ð¿Ð¸Ð½Ð³ÑƒÐµÑ‚ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½Ñ‹Ð¹ Ñ…Ð¾ÑÑ‚ (Cloudflare DNS 1.1.1.1)
   - Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾ Ð´Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð¹ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¸

3. **Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
   - Ð’Ñ‹ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
   - Ð–Ð´ÐµÑ‚ 5 ÑÐµÐºÑƒÐ½Ð´
   - Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
   - Ð–Ð´ÐµÑ‚ 30 ÑÐµÐºÑƒÐ½Ð´ Ð´Ð»Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ
   - ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ

## ðŸ’¡ Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ

### Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð¾Ð¼ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ

```sh
/root/wan_monitor.sh
```

### Ð—Ð°Ð¿ÑƒÑÐº Ð² Ñ„Ð¾Ð½Ðµ

```sh
/root/wan_monitor.sh &
```

### Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð°Ð»Ð¸Ð°ÑÐ°

```sh
# Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² /etc/profile Ð¸Ð»Ð¸ ~/.profile
echo "alias wan-check='/root/wan_monitor.sh'" >> /etc/profile

# Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ
wan-check
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°

```sh
# ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾Ð± Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐµ
ifstatus wan

# ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹
ip route show

# ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð²ÑÐµÑ… Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ¾Ð²
ubus call network.interface dump
```

## ðŸ› ï¸ Ð£ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

### Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð½Ðµ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ

ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑ‹:
```sh
ubus call network.interface dump | jsonfilter -e '@.interface[@.interface!="loopback"].interface'
```

### ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð½Ðµ Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚

1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° Ð² LuCI
2. Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð½Ðµ Ð½Ð° ÑÑ‚Ð¾Ñ€Ð¾Ð½Ðµ Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð°
3. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ (Ð² ÑÐºÑ€Ð¸Ð¿Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ `sleep 30` Ð½Ð° Ð±Ð¾Ð»ÑŒÑˆÐµÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ)

### Ð›Ð¾Ð³ Ñ„Ð°Ð¹Ð» ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹

ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ñ€Ð¾Ñ‚Ð°Ñ†Ð¸ÑŽ Ð»Ð¾Ð³Ð¾Ð²:
```sh
# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» /etc/logrotate.d/wan_monitor
cat > /etc/logrotate.d/wan_monitor << 'EOF'
/var/log/wan_monitor.log {
    size 1M
    rotate 3
    compress
    missingok
    notifempty
}
EOF
```

## âš™ï¸ Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ

- **OpenWrt** 24.10 (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐ»Ð¾ÑÑŒ Ð½Ð° ÑÑ‚Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸)
- **BusyBox** Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼Ð¸: `ping`, `date`, `ifup`, `ifdown`
- **ÐŸÐ°ÐºÐµÑ‚Ñ‹:** `jsonfilter` (Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ)

## ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°

```sh
# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð²Ñ‹Ð²Ð¾Ð´
/root/wan_monitor.sh

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð»Ð¾Ð³ ÑÐ¾Ð·Ð´Ð°Ð½
ls -lh /var/log/wan_monitor.log
```

### Ð¢ÐµÑÑ‚ Ð¿Ñ€Ð¸ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ð¾Ð¼ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ðµ

```sh
# ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ WAN Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
ifdown wan

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚
/root/wan_monitor.sh

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶Ð¸Ñ‚ÑŒ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ð° Ð¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
```

## ðŸ“š Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ

### ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ñ…Ð¾ÑÑ‚Ñ‹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸

Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð½Ð°Ð´ÐµÐ¶Ð½Ñ‹Ðµ DNS ÑÐµÑ€Ð²ÐµÑ€Ñ‹:
- `8.8.4.4` (Google DNS Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹)
- `9.9.9.9` (Quad9)
- `208.67.222.222` (OpenDNS)
- `1.0.0.1` (Cloudflare Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹)
